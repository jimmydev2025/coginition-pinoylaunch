import clsx from 'clsx';
import {
    ReactNode, useEffect, useRef, useState,
} from 'react';
import {
    Command,
    HorizontalLineToCommandMadeAbsolute,
    LineToCommand,
    makeAbsolute,
    parseSVG,
    VerticalLineToCommandMadeAbsolute,
} from 'svg-path-parser';

/**
 * Структура одного пути (с командами)
 */
interface HeartPath {
    commands: Command[],
    needFill: boolean,
    needStroke: boolean,
}

/**
 * Индексы кадров в анимации из нижнего массива
 */
const FRAME_INDICES = [
    0, 1, 2,
];
const FRAME_TIMES = [
    1, 0.8, 0.3,
];
const TOTAL_LENGTH = FRAME_TIMES.reduce((prev, a) => prev + a, 0);

/**
 * Исходные пути из SVG
 */
const ORIGINAL_FRAMES = [

    [
        '<path d="M144.5 219.5L155 195.5L164.5 181L177.5 173.5L183.5 166.357L188 161L199.5 115.5L209.5 82L211.5 43.5L228 43L245.5 45.5L246 65.5L245.5 75L249 64H252.75H256.5L267 65.8375L273.5 66.975L276.5 67.5L274.5 98.5L279.5 57H288L296 57.5L301.5 58.5V71.5L308 73.7237L320.5 78L319 90L327.5 116L327 131.5L324.5 142L319 149L305.5 155L292 150L288 152L276 163L274.125 172L273.5 175L273 184L296.5 179.5L313 185L322 195L320.8 197L338 201L343.5 208.741L356.5 217L352.469 229L358 237L355 252.5L345.5 274L344 274.5L340.25 282.5L353 316.5V357L339 398L316 438L304 451.5L292 456.5L282 458L266.5 453.5L258 450L223 432.5L198 417.5L191 410.5L187 404L174 378.241L160 350.5L153.5 324L157 299L158.275 294L155 288L146.5 266L142 249.5L144.5 219.5Z" fill="#07070C"/>',
        '<path d="M144.5 219.5L155 195.5L164.5 181M144.5 219.5L142 249.5M144.5 219.5L148 255.5M144.5 219.5L164.5 181M144.5 219.5L157.779 205M164.5 181L177.5 173.5M164.5 181L188 172M164.5 181L157.779 205M177.5 173.5L187 168M177.5 173.5L183.5 166.357M188 161L199.5 115.5M188 161L187 168M188 161L183.5 166.357M188 161L197 150M188 161L189.5 163.5M199.5 115.5L209.5 82M199.5 115.5L205.5 123.5M199.5 115.5L197 150M199.5 115.5L207.5 109.5M209.5 82L211.5 43.5M209.5 82L207.5 109.5M209.5 82L213.5 75.5M211.5 43.5L228 43L245.5 45.5M211.5 43.5L217 45.5M211.5 43.5L213.5 75.5M245.5 45.5L240 46.5M245.5 45.5L246 65.5M245.5 45.5L241.5 75.35M240 46.5H227.5M240 46.5V69M227.5 46.5L217 45.5M227.5 46.5L224 61.5M227.5 46.5L234.5 83.5M227.5 46.5L240 69M217 45.5L213.5 75.5M217 45.5L224 61.5M246 65.5L245.5 75M246 65.5L241.5 75.35M245.5 75L249 64M245.5 75L243 81.6999M249 64L246 80.9978M249 64H252.75M274.5 98.5L276.5 67.5L273.5 66.975M274.5 98.5L279.5 57M274.5 98.5L278 97.1304M286 94L296.5 84.5M286 94L278 97.1304M286 94L286.5 59M286 94L296 59.5M286 94L284.5 103.5M286 94L299 100.5M296.5 84.5L301.5 81.5M296.5 84.5L296 59.5M296.5 84.5L301.5 58.5M296.5 84.5L299 100.5M301.5 81.5L299 100.5M301.5 81.5V79.5M301.5 81.5L302.891 89.5M301.5 58.5L296 57.5L288 57H279.5M301.5 58.5L296 59.5M301.5 58.5V71.5M279.5 57L286.5 59M279.5 57L278 97.1304M286.5 59L296 59.5M286.5 59L278 97.1304M278 97.1304L277.344 98.2567M301.5 71.5L308 73.7237M301.5 71.5V79.5M320.5 78L319 90M320.5 78L308 73.7237M320.5 78L309 89.5M320.5 78L314.5 94.5M319 90L327.5 116M319 90L319.193 97.1304M319 90L314.5 94.5M327.5 116L327 131.5M327.5 116L324 123.5M327.5 116L319.5 108.5M327 131.5L324.5 142L319 149M327 131.5L320 136.5M327 131.5L319 149M327 131.5L324 123.5M319 149L305.5 155M319 149L319.12 147.5M305.5 155L292 150M305.5 155L309.5 145.474M292 150L288 152M292 150L302.5 144M292 150L309.5 145.474M288 152L276 163M288 152L295.5 144M288 152L276 158M276 163L274.125 172M276 163V158M273 184L273.5 175L274.125 172M273 184L296.5 179.5L313 185M273 184L268.5 185M313 185L322 195M313 185L263.5 186M313 185L305.5 191.5M322 195L320.8 197M322 195L305.5 191.5M315.5 205L317.8 202M315.5 205L319.862 207M315.5 205L329 219M315.5 205L303.5 218M320.8 197L338 201M320.8 197L317.8 202M320.8 197L319.862 207M338 201L343.5 208.741M338 201L344 219.5M338 201L319.862 207M351.5 220L356.5 217M351.5 220L343.5 208.741M351.5 220L352.469 229M351.5 220L347 233M351.5 220L346.404 248.5M351.5 220L344 219.5M356.5 217L343.5 208.741M356.5 217L352.469 229M355 252.5L358 237L352.469 229M355 252.5L352.469 229M355 252.5L345.5 274M355 252.5L346.288 251.5M355 252.5L345.865 262.5M345.5 274L345.865 262.5M345.5 274H327M345.5 274L344 274.5M345.5 274L338 260M347 233L346.404 248.5M347 233L344 219.5M347 233L338 260M346.404 248.5L346.288 251.5M346.288 251.5L345.865 262.5M327 274L297.5 225.5M327 274L329 219M327 274L344 219.5M327 274L338 260M327 274L321 271.5M327 274L331.5 275.023M327 274L326 301.5M338 276.5L344 274.5M338 276.5L340.25 282.5M338 276.5L333.5 275.477M353 316.5L340.25 282.5M353 316.5V357M353 316.5L333.5 275.477M353 316.5L347 320.5M344 274.5L340.25 282.5M353 357L339 398M353 357L347 320.5M353 357L331 406.5M353 357L340.25 361M339 398L316 438L304 451.5M339 398L331 406.5M304 451.5L292 456.5L282 458M304 451.5L284 455M304 451.5L309 424M304 451.5L331 406.5M282 458L266.5 453.5M282 458L284 455M266.5 453.5L284 455M266.5 453.5L258 450M258 450L223 432.5L198 417.5M258 450L278.5 433.5M258 450L215.5 403M198 417.5L191 410.5L187 404L174 378.241M198 417.5L215.5 403M198 417.5L183.5 382.5M198 417.5L174 378.241M160 350.5L153.5 324L157 299M160 350.5L157 299M160 350.5L174 378.241M160 350.5L178.762 316.5M160 350.5L183.5 382.5M157 299L158.275 294M157 299L176.5 285M157 299L178.762 316.5M163.5 273.5L161.078 283M163.5 273.5L154.218 275M163.5 273.5L168 264.5M163.5 273.5L176.5 285M163.5 273.5L198 255.5M163.5 273.5L193 251M163.5 273.5L179.5 252.566M142 249.5L146.5 266M142 249.5L148 255.5M146.5 266L155 288M146.5 266L154.218 275M146.5 266L148 255.5M155 288L158.275 294M155 288L160.569 285M158.275 294L160.569 285M160.569 285L161.078 283M161.078 283L154.218 275M154.218 275L148 255.5M154.218 275L163 260M154.218 275L168 264.5M148 255.5L163 260M148 255.5L157.779 205M163 260L168 264.5M163 260L157.779 205M163 260L179 238.5M168 264.5L179 238.5M168 264.5L179.5 252.566M188 172L157.779 205M188 172L179 238.5M188 172L215.5 213.5M188 172L232 206M188 172L187 168M188 172L216.5 185M188 172L200 169.75M157.779 205L179 238.5M179 238.5L215.5 213.5M179 238.5L194.5 237M215.5 213.5L232 206M215.5 213.5L194.5 237M215.5 213.5L224.5 218M232 206L227.312 213.5M232 206L229.857 203M224.5 218L213 225.283M224.5 218L227.312 213.5M194.5 237L179.5 252.566M194.5 237L213 225.283M187 168L200 169.75M187 168L183.5 166.357M187 168L189.5 163.5M216.5 185L223 177.5M216.5 185L200 169.75M216.5 185L224.5 195.5M212 167.5L223 177.5M212 167.5L200 169.75M212 167.5L223 132M212 167.5L197 150M212 167.5L195 162M212 167.5L224.127 157M212 167.5L221 171M223 177.5L200 169.75M223 177.5L224 189.5M223 177.5L224.803 172M223 177.5L221 171M200 169.75L195 162M200 169.75L189.5 163.5M176.5 285L198 255.5M176.5 285L216.075 283M176.5 285L178.762 316.5M198 255.5L228.5 221M198 255.5L228 242M198 255.5L193 251M198 255.5L216.075 283M228.5 221L251 227M228.5 221L223.431 225.283M228.5 221L231.5 218M228.5 221L228 242M263.5 186L305.5 191.5M263.5 186L282.5 198.338M263.5 186L251 227M263.5 186L260 189.5M263.5 186L265 185.7M305.5 191.5L304.413 208.741M305.5 191.5L317.8 202M305.5 191.5L282.5 198.338M304.413 208.741L317.8 202M304.413 208.741L282.5 198.338M304.413 208.741L303.5 218M304.413 208.741L297.5 225.5M304.413 208.741L272.5 236.5M282.5 198.338L272.5 236.5M282.5 198.338L251 227M344 219.5L319.862 207M344 219.5L329 219M344 219.5L338 260M297.5 225.5L329 219M297.5 225.5L303 264M297.5 225.5L292 247M297.5 225.5L297.9 249.5M297.5 225.5L303.5 218M303 264L297.973 253.892M303 264L308 266.083M251 227L272.5 236.5M251 227L228 242M272.5 236.5L292 247M272.5 236.5L228 242M272.5 236.5L272 263M292 247L297.973 253.892M292 247L297.9 249.5M292 247L272 263M292 247L293.5 291.5M297.973 253.892L297.9 249.5M228 242L272 263M228 242L216.075 283M272 263L293.5 291.5M272 263L216.075 283M272 263L249 324M272 263L292.5 321.5M293.5 291.5L317 276.5M293.5 291.5L326 301.5M293.5 291.5L292.5 321.5M317 276.5L308 266.083M317 276.5L321 271.5M317 276.5L326 301.5M308 266.083L321 271.5M326 301.5L347 320.5M326 301.5L292.5 321.5M326 301.5L328.5 339.5M347 320.5L331.5 275.023M347 320.5L328.5 339.5M347 320.5L340.25 361M331.5 275.023L333.5 275.477M193 251L179.5 252.566M193 251L213 225.283M193 251L216.075 231.5M179.5 252.566L213 225.283M213 225.283H223.431M213 225.283L216.075 231.5M223.431 225.283L216.075 231.5M227.312 213.5L231.5 218M231.5 218L236 213.5M216.075 283L249 324M216.075 283L220 347M216.075 283L178.762 316.5M249 324L292.5 321.5M249 324L255.5 394.5M249 324L220 347M292.5 321.5L304 369.5M292.5 321.5L328.5 339.5M292.5 321.5L255.5 394.5M255.5 394.5L278.5 433.5M255.5 394.5L304 369.5M255.5 394.5L309 424M255.5 394.5L220 347M255.5 394.5L215.5 403M278.5 433.5L284 455M278.5 433.5L309 424M278.5 433.5L215.5 403M284 455L309 424M304 369.5L328.5 339.5M304 369.5L309 424M328.5 339.5L309 424M328.5 339.5L340.25 361M340.25 361L309 424M340.25 361L331 406.5M331 406.5L309 424M215.5 403L183.5 382.5M215.5 403L220 347M183.5 382.5L174 378.241M183.5 382.5L220 347M183.5 382.5L178.762 316.5M220 347L178.762 316.5M224.5 195.5L224 189.5M224.5 195.5L229.857 203M197 150L223 132M197 150L205.5 123.5M197 150L195 162M197 150L189.5 163.5M223 132L205.5 123.5M223 132L235 116.5M223 132L243 116.5M223 132L224.127 157M223 132L233.5 131M205.5 123.5L207.5 109.5M205.5 123.5L228 102M205.5 123.5L235 116.5M195 162L189.5 163.5M207.5 109.5L228 102M207.5 109.5L223 94M207.5 109.5L213.5 75.5M228 102L239 95M228 102L223 94M228 102L235 116.5M235 116.5L239 95M235 116.5L249 113M235 116.5H243M235 116.5L244.5 110M223 94L213.5 75.5M223 94L223.5 77.75M223 94L234.5 83.5M223 94L240 86M223 94L239 95M213.5 75.5L224 61.5M213.5 75.5L223.5 77.75M224 61.5L223.5 77.75M224 61.5L234.5 83.5M223.5 77.75L234.5 83.5M234.5 83.5L240 86M234.5 83.5L240 69M234.5 83.5L243 81.6999M240 86L239 95M240 86L265.88 83M240 86L258.5 78M240 86L266 80M239 95L255.5 91M239 95L265.88 83M239 95L244.5 110M239 95L250 100M258.5 78L264 78.3056M258.5 78L246 80.9978M267.5 78.5L269.5 82.5L271 93M267.5 78.5L266 80M267.5 78.5L266.5 78.4444M271 93L271.5 104.5M271 93L266 80M271 93L268 103.5M271 93L265.5 92.5M271.5 104.5L268 103.5M271.5 104.5L265 106.956M249 113L244.5 110M249 113L251 120M249 113L246 114.75M249 113L254 111.111M243 116.5L241.197 122M243 116.5L246 114.75M243 116.5L233.5 131M268 103.5L244.5 110M268 103.5L265.88 100M244.5 110L265.88 100M244.5 110L250 100M265.88 100L265.5 92.5M265.88 100H250M266 80L265.88 83M265.5 92.5L265.88 83M265.5 92.5L250 100M265.5 92.5L255.5 91M224 189.5L233 194M224 189.5L234 157M233 194L236 213.5M233 194L229.857 203M233 194L246.5 197M233 194L234 157M236 213.5L244 205.5M246.5 197H252.5M246.5 197L248.5 201M246.5 197L244 205.5M246.5 197L234 157M246.5 197L250 163M252.5 197L248.5 201M252.5 197L260 189.5M248.5 201L244 205.5M234 157L250 163M234 157L251 120M234 157L232.836 147.5M250 163L260 189.5M250 163L266.5 176M250 163L264 159.5M250 163L251 120M250 163L268 135.5M266.5 176L268.5 185M266.5 176L265 185.7M266.5 176L274.125 172M266.5 176L264 159.5M266.5 176L276 158M268.5 185L265 185.7M264 159.5L276 158M264 159.5L268 135.5M264 159.5L295 134M276 158L295.5 144M276 158L295 134M302.5 144L320 136.5M302.5 144L309.5 145.474M302.5 144H295.5M320 136.5L319.12 147.5M320 136.5L309.5 145.474M320 136.5L295.5 144M320 136.5L324 123.5M320 136.5L311.5 128.5M319.12 147.5L309.5 145.474M295.5 144L295 134M295.5 144L311.5 128.5M295 134L311.5 128.5M295 134L310 119M295 134L268 135.5M295 134L291.5 121M311.5 128.5L324 123.5M311.5 128.5L310 119M324 123.5L310 119M324 123.5L319.5 108.5M310 119L319.5 108.5M310 119L291.5 121M310 119L303 110.5M319.5 108.5L303 110.5M319.5 108.5L311 99M319.5 108.5L319.193 97.1304M240 69L241.5 75.35M243 81.6999L241.5 75.35M243 81.6999L246 80.9978M265.88 83L255.5 91M255.5 91L250 100M251 120L268 135.5M251 120L264.5 115M251 120L241.197 122M251 120L246 114.75M251 120L254 111.111M251 120L235 140.9M268 135.5L291.5 121M268 135.5L277.5 112.5M268 135.5L264.5 115M291.5 121L303 110.5M291.5 121L277.5 112.5M291.5 121L284.5 103.5M291.5 121L299 100.5M303 110.5L299 100.5M303 110.5L304 98M303 110.5L311 99M264.5 115L277.5 112.5M264.5 115L265 106.956M264.5 115L274 104M277.5 112.5L284.5 103.5M277.5 112.5L274 104M235 140.9L241.197 122M235 140.9L232.836 147.5M254 111.111L265 106.956M224.803 172L224.127 157M224.803 172L232.836 147.5M224.127 157L233.5 131M224.127 157L232.836 147.5M224.127 157L221 171M233.5 131L232.836 147.5M274 104L267 65.8375M274 104L273.5 66.975M274 104L284.5 103.5M274 104L277.344 98.2567M267 65.8375L256.5 64H252.75M267 65.8375L264 78.3056M267 65.8375L266.5 78.4444M267 65.8375L273.5 66.975M264 78.3056L266.5 78.4444M284.5 103.5L299 100.5M284.5 103.5L277.344 98.2567M299 100.5L304 98M303.5 93L302.891 89.5M303.5 93L309 89.5M303.5 93L303.65 94.5M304 98L311 99M304 98L303.65 94.5M311 99L319.193 97.1304M311 99L309 89.5M311 99L303.65 94.5M319.193 97.1304L314.5 94.5M309 89.5L308 73.7237M309 89.5L314.5 94.5M308 73.7237L301.5 79.5M308 73.7237L302.891 89.5M246 80.9978L252.75 64" stroke="#555565"/>',
    ],
    [
        '<path d="M142 217L153.5 194.5L162.5 179.5L177.5 171L182.5 165.5L187 160.5L198.5 115.5L209 82.5L211.5 44H228L245.5 46L246 65.5L245.5 75L249.5 64.5L253 65L257 65.5L267 66.5L273.5 67.5L276.5 68L275.5 98.5L279.5 58L288 57.5L296 58L301.5 59V72L308 74L320.5 78.5L319 90L327.5 116V130.5L324.5 142L319 148.5L306 154.5L291.5 149L288.5 150L276 161L274.125 172L274 175L274.125 179.5L298 176.5L315 181.5L324.5 192.5L323.5 194.5L340.5 198.5L347.5 209.5L358 216.5L355 227L359.5 237L357.5 251.5L350.5 272.5L347 274.5L344 280.5L358.5 317L359 361L344 406.5L320 450L307.5 465.5L284.5 472L278.5 470L270 467.5L260 464L221 441.5L195.5 425.5L189.5 417.5L183 406.5L171.5 383L155 353L149.5 325.5L152 299L154.5 291L153 288.5L143 265L139.5 249L142 217Z" fill="#07070C"/>',
        '<path d="M142 217L153.5 194.5L162.5 179.5M142 217L139.5 249M142 217L143.5 253M142 217L162.5 179.5M142 217L155 201.5M162.5 179.5L177.5 171M162.5 179.5L186 169M162.5 179.5L155 201.5M177.5 171L185.5 167M177.5 171L182.5 165.5M187 160.5L198.5 115.5M187 160.5L185.5 167M187 160.5L182.5 165.5M187 160.5L195.5 149M187 160.5L188.5 162.5M198.5 115.5L209 82.5M198.5 115.5L204.5 123M198.5 115.5L195.5 149M198.5 115.5L206.5 110M209 82.5L211.5 44M209 82.5L206.5 110M209 82.5L212.5 78.5M211.5 44H228L245.5 46M211.5 44L217 46M211.5 44L212.5 78.5M245.5 46L240 47M245.5 46L246 65.5M245.5 46L241 79.5M240 47H227.5M240 47L239.5 70.5M227.5 47L217 46M227.5 47L223.5 63.5M227.5 47L233.5 85M227.5 47L239.5 70.5M217 46L212.5 78.5M217 46L223.5 63.5M246 65.5L245.5 75M246 65.5L241 79.5M245.5 75L249.5 64.5M245.5 75L240.5 83.5M249.5 64.5L246 81.5M249.5 64.5L253 65M275.5 98.5L276.5 68L273.5 67.5M275.5 98.5L279.5 58M275.5 98.5L278 97.5M286.5 93.1508L296.5 84.5M286.5 93.1508L278 97.5M286.5 93.1508V59.5M286.5 93.1508L296 59.5M286.5 93.1508L284.5 102.5M286.5 93.1508L299 99.5M296.5 84.5L301.5 81.5M296.5 84.5L296 59.5M296.5 84.5L301.5 59M296.5 84.5L299 99.5M301.5 81.5L299 99.5M301.5 81.5V80M301.5 81.5L303 89.5M301.5 59L296 58L288 57.5L279.5 58M301.5 59L296 59.5M301.5 59V72M279.5 58L286.5 59.5M279.5 58L278 97.5M286.5 59.5H296M286.5 59.5L278 97.5M278 97.5V99M301.5 72L308 74M301.5 72V80M320.5 78.5L319 90M320.5 78.5L308 74M320.5 78.5L309 90M320.5 78.5L314.5 94.5M319 90L327.5 116M319 90V97.5M319 90L314.5 94.5M327.5 116V130.5M327.5 116L324 123M327.5 116L320 108M327.5 130.5L324.5 142L319 148.5M327.5 130.5L321 135.5M327.5 130.5L319 148.5M327.5 130.5L324 123M319 148.5L306 154.5M319 148.5V146.5M306 154.5L291.5 149M306 154.5L310 144.5M291.5 149L288.5 150M291.5 149L302.5 142.5M291.5 149L310 144.5M288.5 150L276 161M288.5 150L296.5 141.5M288.5 150L276.5 154.5M276 161L274.125 172M276 161L276.5 154.5M274.125 179.5L274 175L274.125 172M274.125 179.5L298 176.5L315 181.5M274.125 179.5L269 180M315 181.5L324.5 192.5M315 181.5L263.5 181M315 181.5L307 187.5M324.5 192.5L323.5 194.5M324.5 192.5L307 187.5M318.5 201L320.5 198.5M318.5 201L323.5 203M318.5 201L333 214.5M318.5 201L304 217.5M323.5 194.5L340.5 198.5M323.5 194.5L320.5 198.5M323.5 194.5V203M340.5 198.5L347.5 209.5M340.5 198.5L347.5 216M340.5 198.5L323.5 203M353 218.5L358 216.5M353 218.5L347.5 209.5M353 218.5L355 227M353 218.5L350.5 229.5M353 218.5L351 238M353 218.5L347.5 216M358 216.5L347.5 209.5M358 216.5L355 227M357.5 251.5L359.5 237L355 227M357.5 251.5L355 227M357.5 251.5L350.5 272.5M357.5 251.5L351 250M357.5 251.5L350.5 262.5M350.5 272.5V262.5M350.5 272.5L332 271.5M350.5 272.5L347 274.5M350.5 272.5L343 257.5M350.5 229.5L351 238M350.5 229.5L347.5 216M350.5 229.5L343 257.5M351 238V250M351 250L350.5 262.5M332 271.5L301 220M332 271.5L333 214.5M332 271.5L347.5 216M332 271.5L343 257.5M332 271.5L325.5 269M332 271.5L336 273M332 271.5L331.5 301M341 274L347 274.5M341 274L344 280.5M341 274L337.5 273.5M358.5 317L344 280.5M358.5 317L359 361M358.5 317L337.5 273.5M358.5 317L353 321M347 274.5L344 280.5M359 361L344 406.5M359 361L353 321M359 361L337 415.5M359 361L347 366M344 406.5L320 450L307.5 465.5M344 406.5L337 415.5M307.5 465.5L284.5 472L278.5 470M307.5 465.5L286.5 469.5M307.5 465.5L313.5 436.5M307.5 465.5L337 415.5M278.5 470L270 467.5M278.5 470L286.5 469.5M270 467.5L286.5 469.5M270 467.5L260 464M260 464L221 441.5L195.5 425.5M260 464L281 447M260 464L213.5 412.5M195.5 425.5L189.5 417.5L183 406.5L171.5 383M195.5 425.5L213.5 412.5M195.5 425.5L178.762 387.5M195.5 425.5L171.5 383M155 353L149.5 325.5L152 299M155 353L152 299M155 353L171.5 383M155 353L173 316.5M155 353L178.762 387.5M152 299L154.5 291M152 299L171 283.5M152 299L173 316.5M159.5 272.5L157 281.5M159.5 272.5L150.5 273.5M159.5 272.5L162.5 262M159.5 272.5L171 283.5M159.5 272.5L194.5 251M159.5 272.5L189.5 247M159.5 272.5L175.5 249.5M139.5 249L143 265M139.5 249L143.5 253M143 265L153 288.5M143 265L150.5 273.5M143 265L143.5 253M153 288.5L154.5 291M153 288.5L155.5 285.5M154.5 291L155.5 285.5M155.5 285.5L157 281.5M157 281.5L150.5 273.5M150.5 273.5L143.5 253M150.5 273.5L158 257.5M150.5 273.5L162.5 262M143.5 253L158 257.5M143.5 253L155 201.5M158 257.5L162.5 262M158 257.5L155 201.5M158 257.5L174.5 234.5M162.5 262L174.5 234.5M162.5 262L175.5 249.5M186 169L155 201.5M186 169L174.5 234.5M186 169L213 207.5M186 169L231 200M186 169L185.5 167M186 169L215.5 181M186 169L198.5 168.5M155 201.5L174.5 234.5M174.5 234.5L213 207.5M174.5 234.5L191.5 232.5M213 207.5L231 200M213 207.5L191.5 232.5M213 207.5L223 212.5M231 200L225.5 209M231 200L229.5 197.5M223 212.5L211 220M223 212.5L225.5 209M191.5 232.5L175.5 249.5M191.5 232.5L211 220M185.5 167L198.5 168.5M185.5 167L182.5 165.5M185.5 167L188.5 162.5M215.5 181L222.5 176M215.5 181L198.5 168.5M215.5 181L223.5 190.5M210.5 166L222.5 176M210.5 166L198.5 168.5M210.5 166L221.5 131M210.5 166L195.5 149M210.5 166L193.5 161M210.5 166L223.5 156M210.5 166L220 169.5M222.5 176L198.5 168.5M222.5 176L224 187M222.5 176L224.803 172M222.5 176L220 169.5M198.5 168.5L193.5 161M198.5 168.5L188.5 162.5M171 283.5L194.5 251M171 283.5L213 280.5M171 283.5L173 316.5M194.5 251L227.5 215.5M194.5 251L226 236.5M194.5 251L189.5 247M194.5 251L213 280.5M227.5 215.5L251 221M227.5 215.5L220 221M227.5 215.5L229.5 212.5M227.5 215.5L226 236.5M263.5 181L307 187.5M263.5 181L285 192M263.5 181L251 221M263.5 181L260 184M263.5 181L265.5 180M307 187.5L305 205.5M307 187.5L320.5 198.5M307 187.5L285 192M305 205.5L320.5 198.5M305 205.5L285 192M305 205.5L304 217.5M305 205.5L301 220M305 205.5L274.5 231M285 192L274.5 231M285 192L251 221M347.5 216L323.5 203M347.5 216L333 214.5M347.5 216L343 257.5M301 220L333 214.5M301 220L307.5 260.5M301 220L295 242.5M301 220L301.5 245.5M301 220L304 217.5M307.5 260.5L301.5 250.5M307.5 260.5L312 263M251 221L274.5 231M251 221L226 236.5M274.5 231L295 242.5M274.5 231L226 236.5M274.5 231L273.5 259M295 242.5L301.5 250.5M295 242.5L301.5 245.5M295 242.5L273.5 259M295 242.5L297.5 290M301.5 250.5V245.5M226 236.5L273.5 259M226 236.5L213 280.5M273.5 259L297.5 290M273.5 259L213 280.5M273.5 259L249 324M273.5 259L296.5 322M297.5 290L321.5 274.5M297.5 290L331.5 301M297.5 290L296.5 322M321.5 274.5L312 263M321.5 274.5L325.5 269M321.5 274.5L331.5 301M312 263L325.5 269M331.5 301L353 321M331.5 301L296.5 322M331.5 301L335 342.5M353 321L336 273M353 321L335 342.5M353 321L347 366M336 273L337.5 273.5M189.5 247L175.5 249.5M189.5 247L211 220M189.5 247L213.5 226.5M175.5 249.5L211 220M211 220L220 221M211 220L213.5 226.5M220 221L213.5 226.5M225.5 209L229.5 212.5M229.5 212.5L235 207.5M213 280.5L249 324M213 280.5L217.5 350.5M213 280.5L173 316.5M249 324L296.5 322M249 324L256.5 404.5M249 324L217.5 350.5M296.5 322L309 376.313M296.5 322L335 342.5M296.5 322L256.5 404.5M256.5 404.5L281 447M256.5 404.5L309 376.313M256.5 404.5L313.5 436.5M256.5 404.5L217.5 350.5M256.5 404.5L213.5 412.5M281 447L286.5 469.5M281 447L313.5 436.5M281 447L213.5 412.5M286.5 469.5L313.5 436.5M309 376.313L335 342.5M309 376.313L313.5 436.5M335 342.5L313.5 436.5M335 342.5L347 366M347 366L313.5 436.5M347 366L337 415.5M337 415.5L313.5 436.5M213.5 412.5L178.762 387.5M213.5 412.5L217.5 350.5M178.762 387.5L171.5 383M178.762 387.5L217.5 350.5M178.762 387.5L173 316.5M217.5 350.5L173 316.5M223.5 190.5L224 187M223.5 190.5L229.5 197.5M195.5 149L221.5 131M195.5 149L204.5 123M195.5 149L193.5 161M195.5 149L188.5 162.5M221.5 131L204.5 123M221.5 131L234 116.5M221.5 131L242 116.5M221.5 131L223.5 156M221.5 131L233 130.5M204.5 123L206.5 110M204.5 123L226.5 103M204.5 123L234 116.5M193.5 161L188.5 162.5M206.5 110L226.5 103M206.5 110L221.5 96M206.5 110L212.5 78.5M226.5 103L238 95M226.5 103L221.5 96M226.5 103L234 116.5M234 116.5L238 95M234 116.5L249 112M234 116.5H242M234 116.5L243.5 109.5M221.5 96L212.5 78.5M221.5 96L222.5 80M221.5 96L233.5 85M221.5 96L239 87M221.5 96L238 95M212.5 78.5L223.5 63.5M212.5 78.5L222.5 80M223.5 63.5L222.5 80M223.5 63.5L233.5 85M222.5 80L233.5 85M233.5 85L239 87M233.5 85L239.5 70.5M233.5 85L240.5 83.5M239 87L238 95M239 87L265.88 82M239 87L258.5 78M239 87L266.5 79.5M238 95L255 90M238 95L265.88 82M238 95L243.5 109.5M238 95L249.5 99M258.5 78L264 78.3056M258.5 78L246 81.5M267.5 78.5L269.5 82.5L270.5 92M267.5 78.5L266.5 79.5M267.5 78.5L266.5 78.4444M270.5 92L271 102.5M270.5 92L266.5 79.5M270.5 92L268.5 101M270.5 92L265.5 91M271 102.5L268.5 101M271 102.5L265 105.5M249 112L243.5 109.5M249 112L250.5 119.5M249 112L245.5 114.5M249 112L253.5 110M242 116.5L241 121.5M242 116.5L245.5 114.5M242 116.5L233 130.5M268.5 101L243.5 109.5M268.5 101L265.5 98.5M243.5 109.5L265.5 98.5M243.5 109.5L249.5 99M265.5 98.5V91M265.5 98.5L249.5 99M266.5 79.5L265.88 82M265.5 91L265.88 82M265.5 91L249.5 99M265.5 91L255 90M224 187L232 190M224 187L233.5 154.5M232 190L235 207.5M232 190L229.5 197.5M232 190L246 192.5M232 190L233.5 154.5M235 207.5L242.5 201M246 192.5H251M246 192.5L246.5 197M246 192.5L242.5 201M246 192.5L233.5 154.5M246 192.5L250 159M251 192.5L246.5 197M251 192.5L260 184M246.5 197L242.5 201M233.5 154.5L250 159M233.5 154.5L250.5 119.5M233.5 154.5L231.5 143M250 159L260 184M250 159L267 172M250 159L264.5 155.5M250 159L250.5 119.5M250 159L268 132M267 172L269 180M267 172L265.5 180M267 172H274.125M267 172L264.5 155.5M267 172L276.5 154.5M269 180H265.5M264.5 155.5L276.5 154.5M264.5 155.5L268 132M264.5 155.5L295.5 131.5M276.5 154.5L296.5 141.5M276.5 154.5L295.5 131.5M302.5 142.5L321 135.5M302.5 142.5L310 144.5M302.5 142.5L296.5 141.5M321 135.5L319 146.5M321 135.5L310 144.5M321 135.5L296.5 141.5M321 135.5L324 123M321 135.5L312 127.5M319 146.5L310 144.5M296.5 141.5L295.5 131.5M296.5 141.5L312 127.5M295.5 131.5L312 127.5M295.5 131.5L311 117.5M295.5 131.5L268 132M295.5 131.5L292.5 118.5M312 127.5L324 123M312 127.5L311 117.5M324 123L311 117.5M324 123L320 108M311 117.5L320 108M311 117.5L292.5 118.5M311 117.5L303.5 109M320 108L303.5 109M320 108L311 99M320 108L319 97.5M239.5 70.5L241 79.5M240.5 83.5L241 79.5M240.5 83.5L246 81.5M265.88 82L255 90M255 90L249.5 99M250.5 119.5L268 132M250.5 119.5L264.5 113.5M250.5 119.5L241 121.5M250.5 119.5L245.5 114.5M250.5 119.5L253.5 110M250.5 119.5L234.5 139M268 132L292.5 118.5M268 132L278 110.5M268 132L264.5 113.5M292.5 118.5L303.5 109M292.5 118.5L278 110.5M292.5 118.5L284.5 102.5M292.5 118.5L299 99.5M303.5 109L299 99.5M303.5 109L304 98M303.5 109L311 99M264.5 113.5L278 110.5M264.5 113.5L265 105.5M264.5 113.5L274 103M278 110.5L284.5 102.5M278 110.5L274 103M234.5 139L241 121.5M234.5 139L231.5 143M253.5 110L265 105.5M224.803 172L223.5 156M224.803 172L231.5 143M223.5 156L233 130.5M223.5 156L231.5 143M223.5 156L220 169.5M233 130.5L231.5 143M274 103L267 66.5M274 103L273.5 67.5M274 103L284.5 102.5M274 103L278 99M267 66.5L257 65.5L253 65M267 66.5L264 78.3056M267 66.5L266.5 78.4444M267 66.5L273.5 67.5M264 78.3056L266.5 78.4444M284.5 102.5L299 99.5M284.5 102.5L278 99M299 99.5L304 98M303.5 93L303 89.5M303.5 93L309 90M303.5 93L303.65 94.5M304 98L311 99M304 98L303.65 94.5M311 99L319 97.5M311 99L309 90M311 99L303.65 94.5M319 97.5L314.5 94.5M309 90L308 74M309 90L314.5 94.5M308 74L301.5 80M308 74L303 89.5M246 81.5L253 65" stroke="#555565"/>',
    ],
    [
        '<path d="M142 217L153.5 194.5L163 178.5L177 170.5L182 165L187 159.5L198.5 114.5L209 82.5L212 43.5H228L245.5 45L246 64.5L245.5 73.5L249.5 63L253 62.5H258.5L267.5 63L273.5 64L276.5 64.5L275.5 98.5L280 54.5H286.5L296.5 55L301.5 56L302 68.5L308 70.5L320.5 76L319 89L328 115L327.5 130.5L324.5 142L319 148L306 153.5L291 147.5L288.5 148L277 158L275 167L274.5 175V178.5L298 175.5L315 181.5L323.5 192L323 194L340 198.5L347.5 209.5L357.5 215.5L354.5 228L359.5 237L357 251L349.5 271.5L346 274L344 280.5L357.5 315.5L358 359L343 403.5L319 448L306.5 462L294 467L284.5 468.5L268 464L259.5 460.5L223 440.5L196 423.5L190 416.5L184 406L172.5 382L156 352.5L150 325L153 298.5L154.5 291L153 287.5L143.5 264L140 248.5L142 217Z" fill="#07070C"/>',
        '<path d="M142 217L153.5 194.5L163 178.5M142 217L140 248.5M142 217L144 252.5M142 217L163 178.5M142 217L155 201M163 178.5L177 170.5M163 178.5L186 168.5M163 178.5L155 201M177 170.5L185 166.5M177 170.5L182 165M187 159.5L198.5 114.5M187 159.5L185 166.5M187 159.5L182 165M187 159.5L195.5 148M187 159.5L188 161.5M198.5 114.5L209 82.5M198.5 114.5L204.5 122M198.5 114.5L195.5 148M198.5 114.5L206.5 109M209 82.5L212 43.5M209 82.5L206.5 109M209 82.5L213 76.5M212 43.5H228L245.5 45M212 43.5L217 46M212 43.5L213 76.5M245.5 45L240 47M245.5 45L246 64.5M245.5 45L241 79.5M240 47H227.5M240 47L239.5 69M227.5 47L217 46M227.5 47L223.5 62.5M227.5 47L233.5 83.5M227.5 47L239.5 69M217 46L213 76.5M217 46L223.5 62.5M246 64.5L245.5 73.5M246 64.5L241 79.5M245.5 73.5L249.5 63M245.5 73.5L241 81.5M249.5 63L246 80M249.5 63L253 62.5M275.5 98.5L276.5 64.5L273.5 64M275.5 98.5L280 54.5M275.5 98.5L278 95M286.5 90L297 81M286.5 90L278 95M286.5 90V56M286.5 90L296 56.5M286.5 90L285 100M286.5 90L299.5 96.5M297 81L302 78M297 81L296 56.5M297 81L301.5 56M297 81L299.5 96.5M302 78L299.5 96.5M302 78V76.5M302 78L303.5 87M301.5 56L296.5 55L286.5 54.5H280M301.5 56L296 56.5M301.5 56L302 68.5M280 54.5L286.5 56M280 54.5L278 95M286.5 56L296 56.5M286.5 56L278 95M278 95L280.5 97M302 68.5L308 70.5M302 68.5V76.5M320.5 76L319 89M320.5 76L308 70.5M320.5 76L309.5 86.5M320.5 76L314.5 91.5M319 89L328 115M319 89V95M319 89L314.5 91.5M328 115L327.5 130.5M328 115L324.5 121M328 115L320 105.5M327.5 130.5L324.5 142L319 148M327.5 130.5L321 134M327.5 130.5L319 148M327.5 130.5L324.5 121M319 148L306 153.5M319 148L319.5 145.5M306 153.5L291 147.5M306 153.5L310 143M291 147.5L288.5 148M291 147.5L303 140.5M291 147.5L310 143M288.5 148L277 158M288.5 148L297.5 138.5M288.5 148L278 151.5M277 158L275 167M277 158L278 151.5M274.5 178.5V175L275 167M274.5 178.5L298 175.5L315 181.5M274.5 178.5L269.5 179M315 181.5L323.5 192M315 181.5L264 180M315 181.5L307 187M323.5 192L323 194M323.5 192L307 187M318 200.5L320 198M318 200.5L323 203M318 200.5L332.5 214.5M318 200.5L304.5 214.5M323 194L340 198.5M323 194L320 198M323 194V203M340 198.5L347.5 209.5M340 198.5L347 216M340 198.5L323 203M353 218.5L357.5 215.5M353 218.5L347.5 209.5M353 218.5L354.5 228M353 218.5L350 229.5M353 218.5L350.5 238M353 218.5L347 216M357.5 215.5L347.5 209.5M357.5 215.5L354.5 228M357 251L359.5 237L354.5 228M357 251L354.5 228M357 251L349.5 271.5M357 251L350 249.5M357 251L350 262M349.5 271.5L350 262M349.5 271.5H331M349.5 271.5L346 274M349.5 271.5L342 257.5M350 229.5L350.5 238M350 229.5L347 216M350 229.5L342 257.5M350.5 238L350 249.5M350 249.5V262M331 271.5L300.5 220.5M331 271.5L332.5 214.5M331 271.5L347 216M331 271.5L342 257.5M331 271.5L325.5 268.5M331 271.5L335.5 273M331 271.5L330.5 300M340.5 274H346M340.5 274L344 280.5M340.5 274L337.5 273.5M357.5 315.5L344 280.5M357.5 315.5L358 359M357.5 315.5L337.5 273.5M357.5 315.5L352 320.5M346 274L344 280.5M358 359L343 403.5M358 359L352 320.5M358 359L336 413.5M358 359L346 364.5M343 403.5L319 448L306.5 462M343 403.5L336 413.5M306.5 462L294 467L284.5 468.5M306.5 462L286 466.5M306.5 462L313 433.5M306.5 462L336 413.5M284.5 468.5L268 464M284.5 468.5L286 466.5M268 464L286 466.5M268 464L259.5 460.5M259.5 460.5L223 440.5L196 423.5M259.5 460.5L280.5 444M259.5 460.5L213.5 410M196 423.5L190 416.5L184 406L172.5 382M196 423.5L213.5 410M196 423.5L180 386M196 423.5L172.5 382M156 352.5L150 325L153 298.5M156 352.5L153 298.5M156 352.5L172.5 382M156 352.5L174 315.5M156 352.5L180 386M153 298.5L154.5 291M153 298.5L172 282.5M153 298.5L174 315.5M160.5 271.5L157.5 281M160.5 271.5L150.5 273.5M160.5 271.5L164 261M160.5 271.5L172 282.5M160.5 271.5L195 250.5M160.5 271.5L190.5 246.5M160.5 271.5L175.5 249.5M140 248.5L143.5 264M140 248.5L144 252.5M143.5 264L153 287.5M143.5 264L150.5 273.5M143.5 264L144 252.5M153 287.5L154.5 291M153 287.5L156.5 284.5M154.5 291L156.5 284.5M156.5 284.5L157.5 281M157.5 281L150.5 273.5M150.5 273.5L144 252.5M150.5 273.5L159 257M150.5 273.5L164 261M144 252.5L159 257M144 252.5L155 201M159 257L164 261M159 257L155 201M159 257L175.5 234M164 261L175.5 234M164 261L175.5 249.5M186 168.5L155 201M186 168.5L175.5 234M186 168.5L213 207.5M186 168.5L231 200M186 168.5L185 166.5M186 168.5L215.5 181M186 168.5L198 167.5M155 201L175.5 234M175.5 234L213 207.5M175.5 234L191.5 232.5M213 207.5L231 200M213 207.5L191.5 232.5M213 207.5L223 212.5M231 200L225.5 209M231 200L229.5 197.5M223 212.5L211 220.5M223 212.5L225.5 209M191.5 232.5L175.5 249.5M191.5 232.5L211 220.5M185 166.5L198 167.5M185 166.5L182 165M185 166.5L188 161.5M215.5 181L221 175M215.5 181L198 167.5M215.5 181L223.5 190.5M210.5 165L221 175M210.5 165L198 167.5M210.5 165L222 130M210.5 165L195.5 148M210.5 165L193 160M210.5 165L223.5 154M210.5 165L219.5 169M221 175L198 167.5M221 175L223 186M221 175L224.5 171.5M221 175L219.5 169M198 167.5L193 160M198 167.5L188 161.5M172 282.5L195 250.5M172 282.5L213.5 280M172 282.5L174 315.5M195 250.5L227.5 215.5M195 250.5L226 236.5M195 250.5L190.5 246.5M195 250.5L213.5 280M227.5 215.5L251 221M227.5 215.5L220 221M227.5 215.5L229.5 213M227.5 215.5L226 236.5M264 180L307 187M264 180L284.5 192M264 180L251 221M264 180L260.5 183.5M264 180L266 179.5M307 187L304.5 205.5M307 187L320 198M307 187L284.5 192M304.5 205.5L320 198M304.5 205.5L284.5 192M304.5 205.5V214.5M304.5 205.5L300.5 220.5M304.5 205.5L274 231M284.5 192L274 231M284.5 192L251 221M347 216L323 203M347 216L332.5 214.5M347 216L342 257.5M300.5 220.5L332.5 214.5M300.5 220.5L307 260M300.5 220.5L295 242.5M300.5 220.5L301 245.5M300.5 220.5L304.5 214.5M307 260L301 250.5M307 260L312 263M251 221L274 231M251 221L226 236.5M274 231L295 242.5M274 231L226 236.5M274 231L273.5 259M295 242.5L301 250.5M295 242.5L301 245.5M295 242.5L273.5 259M295 242.5L296.5 289M301 250.5V245.5M226 236.5L273.5 259M226 236.5L213.5 280M273.5 259L296.5 289M273.5 259L213.5 280M273.5 259L249 324M273.5 259L295.5 321M296.5 289L321 274M296.5 289L330.5 300M296.5 289L295.5 321M321 274L312 263M321 274L325.5 268.5M321 274L330.5 300M312 263L325.5 268.5M330.5 300L352 320.5M330.5 300L295.5 321M330.5 300L333.5 341M352 320.5L335.5 273M352 320.5L333.5 341M352 320.5L346 364.5M335.5 273L337.5 273.5M190.5 246.5L175.5 249.5M190.5 246.5L211 220.5M190.5 246.5L213.5 227M175.5 249.5L211 220.5M211 220.5L220 221M211 220.5L213.5 227M220 221L213.5 227M225.5 209L229.5 213M229.5 213L235 207.5M213.5 280L249 324M213.5 280L217.5 349.5M213.5 280L174 315.5M249 324L295.5 321M249 324L256.5 402M249 324L217.5 349.5M295.5 321L308 374.5M295.5 321L333.5 341M295.5 321L256.5 402M256.5 402L280.5 444M256.5 402L308 374.5M256.5 402L313 433.5M256.5 402L217.5 349.5M256.5 402L213.5 410M280.5 444L286 466.5M280.5 444L313 433.5M280.5 444L213.5 410M286 466.5L313 433.5M308 374.5L333.5 341M308 374.5L313 433.5M333.5 341L313 433.5M333.5 341L346 364.5M346 364.5L313 433.5M346 364.5L336 413.5M336 413.5L313 433.5M213.5 410L180 386M213.5 410L217.5 349.5M180 386L172.5 382M180 386L217.5 349.5M180 386L174 315.5M217.5 349.5L174 315.5M223.5 190.5L223 186M223.5 190.5L229.5 197.5M195.5 148L222 130M195.5 148L204.5 122M195.5 148L193 160M195.5 148L188 161.5M222 130L204.5 122M222 130L234 115.5M222 130L242.5 115.5M222 130L223.5 154M222 130L233 128.5M204.5 122L206.5 109M204.5 122L227 102M204.5 122L234 115.5M193 160L188 161.5M206.5 109L227 102M206.5 109L222 95M206.5 109L213 76.5M227 102L238.5 94M227 102L222 95M227 102L234 115.5M234 115.5L238.5 94M234 115.5L249 111M234 115.5H242.5M234 115.5L243.5 109.5M222 95L213 76.5M222 95L222.5 79M222 95L233.5 83.5M222 95L239.5 85.5M222 95L238.5 94M213 76.5L223.5 62.5M213 76.5L222.5 79M223.5 62.5L222.5 79M223.5 62.5L233.5 83.5M222.5 79L233.5 83.5M233.5 83.5L239.5 85.5M233.5 83.5L239.5 69M233.5 83.5L241 81.5M239.5 85.5L238.5 94M239.5 85.5L266 80M239.5 85.5L258.5 76M239.5 85.5L266 77M238.5 94L254.5 89M238.5 94L266 80M238.5 94L243.5 109.5M238.5 94L249.5 99M258.5 76L264 75.5M258.5 76L246 80M268.5 78.5L269.5 82.5L271 91M268.5 78.5L266 77M268.5 78.5L267 76M271 91L271.5 101.5M271 91L266 77M271 91L268.5 100.5M271 91L265.5 89.5M271.5 101.5L268.5 100.5M271.5 101.5L265 104.5M249 111L243.5 109.5M249 111L251 117.5M249 111L246 113.5M249 111L253.5 109M242.5 115.5L241 121.5M242.5 115.5L246 113.5M242.5 115.5L233 128.5M268.5 100.5L243.5 109.5M268.5 100.5L266 97.5M243.5 109.5L266 97.5M243.5 109.5L249.5 99M266 97.5L265.5 89.5M266 97.5L249.5 99M266 77V80M265.5 89.5L266 80M265.5 89.5L249.5 99M265.5 89.5L254.5 89M223 186L232 190M223 186L233.5 152M232 190L235 207.5M232 190L229.5 197.5M232 190L246 192.5M232 190L233.5 152M235 207.5L243.5 200M246 192.5H251M246 192.5L248 195.5M246 192.5L243.5 200M246 192.5L233.5 152M246 192.5L250.5 156.159M251 192.5L248 195.5M251 192.5L260.5 183.5M248 195.5L243.5 200M233.5 152L250.5 156.159M233.5 152L251 117.5M233.5 152L232 140.5M250.5 156.159L260.5 183.5M250.5 156.159L268 169.5M250.5 156.159L265 152M250.5 156.159L251 117.5M250.5 156.159L268.5 129.5M268 169.5L269.5 179M268 169.5L266 179.5M268 169.5L275 167M268 169.5L265 152M268 169.5L278 151.5M269.5 179L266 179.5M265 152L278 151.5M265 152L268.5 129.5M265 152L296 129M278 151.5L297.5 138.5M278 151.5L296 129M303 140.5L321 134M303 140.5L310 143M303 140.5L297.5 138.5M321 134L319.5 145.5M321 134L310 143M321 134L297.5 138.5M321 134L324.5 121M321 134L312.5 125M319.5 145.5L310 143M297.5 138.5L296 129M297.5 138.5L312.5 125M296 129L312.5 125M296 129L311 115M296 129L268.5 129.5M296 129L292.5 116.5M312.5 125L324.5 121M312.5 125L311 115M324.5 121L311 115M324.5 121L320 105.5M311 115L320 105.5M311 115L292.5 116.5M311 115L303.5 107M320 105.5L303.5 107M320 105.5L311 96M320 105.5L319 95M239.5 69L241 79.5M241 81.5V79.5M241 81.5L246 80M266 80L254.5 89M254.5 89L249.5 99M251 117.5L268.5 129.5M251 117.5L264.5 112M251 117.5L241 121.5M251 117.5L246 113.5M251 117.5L253.5 109M251 117.5L235 136M268.5 129.5L292.5 116.5M268.5 129.5L278 109M268.5 129.5L264.5 112M292.5 116.5L303.5 107M292.5 116.5L278 109M292.5 116.5L285 100M292.5 116.5L299.5 96.5M303.5 107L299.5 96.5M303.5 107L304 94.5M303.5 107L311 96M264.5 112L278 109M264.5 112L265 104.5M264.5 112L274 101.5M278 109L285 100M278 109L274 101.5M235 136L241 121.5M235 136L232 140.5M253.5 109L265 104.5M224.5 171.5L223.5 154M224.5 171.5L232 140.5M223.5 154L233 128.5M223.5 154L232 140.5M223.5 154L219.5 169M233 128.5L232 140.5M274 101.5L267.5 63M274 101.5L273.5 64M274 101.5L285 100M274 101.5L280.5 97M267.5 63L258.5 62.5H253M267.5 63L264 75.5M267.5 63L267 76M267.5 63L273.5 64M264 75.5L267 76M285 100L299.5 96.5M285 100L280.5 97M299.5 96.5L304 94.5M304 89.5L303.5 87M304 89.5L309.5 86.5M304 89.5V91.5M304 94.5L311 96M304 94.5V91.5M311 96L319 95M311 96L309.5 86.5M311 96L304 91.5M319 95L314.5 91.5M309.5 86.5L308 70.5M309.5 86.5L314.5 91.5M308 70.5L302 76.5M308 70.5L303.5 87M246 80L253 62.5" stroke="#555565"/>',
    ],

].map((group) => {
    const paths: HeartPath[] = [];
    for (const rawPath of group) {
        // Парсим D-тег
        const matches = (/d="([a-z\d. ]+)"/gim).exec(rawPath);
        if (matches && matches[1]) {
            const commands = parseSVG(matches[1]);
            makeAbsolute(commands);
            paths.push({
                commands: commands.map((cmd) => {
                    // Фиксим горизонтальные и вертикальные линии - они станут просто линиями
                    if (cmd.code === 'H') {
                        return {
                            code: 'L',
                            command: 'lineto',
                            x: cmd.x,
                            y: (cmd as HorizontalLineToCommandMadeAbsolute).y0,
                        } as LineToCommand;
                    } if (cmd.code === 'V') {
                        return {
                            code: 'L',
                            command: 'lineto',
                            x: (cmd as VerticalLineToCommandMadeAbsolute).x0,
                            y: cmd.y,
                        } as LineToCommand;
                    }
                    return cmd;
                }),
                needFill: rawPath.toLowerCase().includes('fill='),
                needStroke: rawPath.toLowerCase().includes('stroke='),
            });
        }
    }
    return paths;
});

/**
 * Сборка переходного кадра из одного в другое
 * @param indexFirst
 * @param indexSecond
 * @param alpha
 */
const lerpFrames = (indexFirst: number, indexSecond: number, alpha: number): HeartPath[] => {
    const paths: HeartPath[] = [];
    const first = ORIGINAL_FRAMES[indexFirst];
    const second = ORIGINAL_FRAMES[indexSecond];
    const props = ['x', 'y', 'x1', 'y1', 'x2', 'y2'];
    for (let pn = 0; pn < first.length; pn++) {
        // Собираем два пути
        const path1 = first[pn];
        const path2 = second[pn];
        const cmds: Command[] = [];
        for (let c = 0; c < path1.commands.length; c++) {
            // Делаем копию первой команды, и потом интерполируем найденные свойства
            const cmd = {
                ...path1.commands[c],
            } as any;
            const cmd2 = path2.commands[c] as any;
            for (const key of props) {
                if (key in cmd && key in cmd2) {
                    cmd[key] += (cmd2[key] - cmd[key]) * alpha;
                }
            }
            cmds.push(cmd as Command);
        }
        paths.push({
            commands: cmds,
            needFill: path1.needFill,
            needStroke: path1.needStroke,
        });
    }
    return paths;
};

/**
 * Сборка SVG-путей из комманд
 * @param originalPaths
 * @param fill
 * @param stroke
 */
const assemblePaths = (originalPaths: HeartPath[], fill: string = '#00f', stroke: string = '#fff'): ReactNode[] => {
    const nodes: ReactNode[] = [];
    for (const rawPath of originalPaths) {
        let rawSvg = '';
        for (const c of rawPath.commands) {
            switch (c.code) {
                case 'M':
                    rawSvg += `M ${c.x} ${c.y} `;
                    break;

                case 'H':
                    rawSvg += `H ${c.x} `;
                    break;

                case 'V':
                    rawSvg += `V ${c.y} `;
                    break;

                case 'L':
                    rawSvg += `L ${c.x} ${c.y} `;
                    break;

                case 'C':
                    rawSvg += `C ${c.x1} ${c.y1}, ${c.x2} ${c.y2}, ${c.x} ${c.y} `;
                    break;

                case 'Z':
                    rawSvg += 'Z';
                    break;

                default:
                    break;
            }
        }
        nodes.push(<path
            d={rawSvg}
            fill={rawPath.needFill ? fill : undefined}
            stroke={rawPath.needStroke ? stroke : undefined}
            key={nodes.length}
        />);
    }
    return nodes;
};

/**
 * Класс для обработки анимации
 */
class HeartAnimation {
    /**
     * Хендл запрошенного кадра
     * @private
     */
    private rafHandle: number = 0;

    /**
     * Предыдущий штамп
     * @private
     */
    private rafTime: number = 0;

    /**
     * Текущее время на таймлайне
     * @private
     */
    private time: number = 0;

    /**
     * Множитель времени
     * @private
     */
    private timeModifier: number = 0;

    /**
     * Флаг активного сердцебиения
     * @private
     */
    private active: boolean = false;

    /**
     * Хендлер для обновления стейта
     * @private
     */
    private readonly updateFunc: (state: ReactNode[]) => void;

    /**
     * Конструктор
     * @param update
     */
    constructor(update: (state: ReactNode[]) => void) {
        this.updateFunc = update;
    }

    /**
     * Обновление активного сердцебиения
     * @param state
     */
    public setActive(state: boolean) {
        this.active = state;
    }

    /**
     * Привязка к RAF
     */
    public bind() {
        this.update = this.update.bind(this);
        this.rafTime = performance.now();
        this.update(this.rafTime);
    }

    /**
     * Отвязка
     */
    public unbind() {
        cancelAnimationFrame(this.rafHandle);
    }

    /**
     * Обновление логики
     * @param rawTime
     * @private
     */
    private update(rawTime: number) {
        this.rafHandle = requestAnimationFrame(this.update);
        const delta = (rawTime - this.rafTime) / 16.666;
        this.rafTime = rawTime;

        // Обновление модифайра
        this.timeModifier = Math.min(Math.max(this.timeModifier + (this.active ? 0.03 : -0.01) * delta, 0.0), 1.0);

        // Обновление таймлайна
        this.time = (this.time + (0.03 + this.timeModifier * 0.03) * delta) % TOTAL_LENGTH;
        let frameIndex = 0;
        let frameDiv = 20;
        let activeTime = this.time;
        for (let i = 0; i < FRAME_TIMES.length; i++) {
            const len = FRAME_TIMES[i];
            if (activeTime < len) {
                frameIndex = i;
                frameDiv = len;
                break;
            } else {
                activeTime -= len;
            }
        }
        const alpha = activeTime / frameDiv;
        const firstFrame = FRAME_INDICES[frameIndex];
        const secondFrame = FRAME_INDICES[(frameIndex + 1) % FRAME_INDICES.length];

        // Апдейт путей
        this.updateFunc(assemblePaths(
            lerpFrames(
                firstFrame,
                secondFrame,
                alpha,
            ),
            '#000',
            'url(#HeartGradient)',
        ));
    }
}

/**
 * Пропсы компонента
 */
interface HeartProps {
    active: boolean
}

/**
 * Компонент
 * @param active
 * @constructor
 */
export function BeatingHeart({ active }: HeartProps) {
    const animationRef = useRef<HeartAnimation | null>(null);
    const [nodesState, setNodesState] = useState<ReactNode[]>([]);

    // Бинд анимации
    useEffect(() => {
        animationRef.current = new HeartAnimation((nodes) => {
            setNodesState(nodes);
        });
        animationRef.current?.bind();
        return () => {
            animationRef.current?.unbind();
        };
    }, []);

    // Передача учащенной анимации
    useEffect(() => {
        animationRef.current?.setActive(active);
    }, [active]);

    // Рендер
    return (
        <svg className={clsx(active && 'active')} viewBox="0 0 500 500" fill="none" xmlns="http://www.w3.org/2000/svg">
            <linearGradient id="HeartGradient" x1="0" y1="0" x2="100" y2="452" gradientUnits="userSpaceOnUse">
                <stop offset="30%" stopColor="#555565" />
                <stop offset="100%" stopColor="#555565" />
            </linearGradient>
            {nodesState}
        </svg>
    );
}
