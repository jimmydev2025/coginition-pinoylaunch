import { useStore } from 'effector-react';
import { useEffect, useState } from 'react';
import { SoundManager, SoundType } from '../../../sounds/SoundManager';
import { setSoundEnabled, soundEnabledStore } from '../../../store/page';
import { SoundBars } from '../../shared/SoundBars/SoundBars';
import { LoginMenu } from '../Menu/LoginMenu';
import './Header.scss';

interface HeaderProps {
    onLogoClick?: () => void,
    onAuthChange: (state: boolean) => void,
}

export function Header(props: HeaderProps) {
    const {
        onLogoClick,
        onAuthChange,
    } = props;
    const [loginActive, setLoginActive] = useState(false);
    const soundActive = useStore(soundEnabledStore);

    useEffect(() => {
        if (onAuthChange) {
            onAuthChange(loginActive);
        }
    }, [loginActive]);

    const onMainLogoClick = () => {
        SoundManager.play(SoundType.Button);
        if (onLogoClick) onLogoClick();
    };
    const onLoginClick = () => {
        setTimeout(() => {
            setLoginActive(true);
            SoundManager.play(SoundType.Button);
        }, 10);
    };
    const onSoundClick = () => {
        setSoundEnabled(!soundActive);
    };
    const onLoginClickOutside = () => {
        if (loginActive) {
            SoundManager.playHover();
        }
        setLoginActive(false);
    };

    return (
        <header>
            <div className="left">
                <button type="button" className="logo" onClick={onMainLogoClick}>
                    <svg viewBox="0 0 80 58" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <line x1="4.49452e-08" y1="16.8145" x2="80" y2="16.8145" stroke="white" />
                        <path d="M5.66211 17.3137C5.66211 14.5999 6.75494 10.6312 9.34494 7.34895C11.9197 4.08606 15.9732 1.5 21.9363 1.5V0.5C15.6413 0.5 11.3077 3.24727 8.55992 6.72948C5.82734 10.1924 4.66211 14.3805 4.66211 17.3137H5.66211ZM21.9363 1.5C28.2369 1.5 32.2737 3.94206 34.9139 7.04925C37.5715 10.1768 38.8386 14.0087 39.5148 16.8039L40.4868 16.5687C39.7968 13.7168 38.4833 9.70556 35.676 6.40173C32.8513 3.07755 28.5389 0.5 21.9363 0.5V1.5ZM39.5148 16.8039C40.2113 19.6824 41.8531 23.8389 44.8111 27.2864C47.7792 30.7456 52.0841 33.5 58.0653 33.5V32.5C52.4337 32.5 48.3894 29.9211 45.57 26.6352C42.7406 23.3375 41.1566 19.3372 40.4868 16.5687L39.5148 16.8039ZM58.0653 33.5C64.7178 33.5 69.0505 30.0921 71.7008 26.3064C73.0229 24.4178 73.9299 22.4322 74.5069 20.7184C75.0808 19.0141 75.3395 17.5451 75.3395 16.6863H74.3395C74.3395 17.396 74.1144 18.7506 73.5592 20.3993C73.0073 22.0384 72.1401 23.9352 70.8815 25.7329C68.3705 29.3197 64.3161 32.5 58.0653 32.5V33.5ZM4.66211 17.3137V21.0784H5.66211V17.3137H4.66211ZM75.3395 16.6863V13.549H74.3395V16.6863H75.3395Z" fill="white" />
                        <ellipse cx="5.16072" cy="27.3531" rx="2.58065" ry="2.5098" fill="none" fillOpacity="0.6" stroke="white" />
                        <ellipse cx="74.8404" cy="7.27494" rx="2.58065" ry="2.5098" fill="white" />
                        <g className="sub-text">
                            <path d="M0 57.6378V51.0529C0.0408984 49.5645 0.579394 48.3392 1.61549 47.377C2.59705 46.4299 3.73539 45.9713 5.0305 46.0014C6.31199 46.0014 7.47759 46.4599 8.52732 47.377C9.67247 48.3542 10.2451 49.572 10.2451 51.0303V57.6378H9.36574V51.0529C9.36574 49.8952 8.90222 48.918 7.97519 48.1212C7.10269 47.3545 6.12113 46.9711 5.0305 46.9711C3.96715 46.941 3.01967 47.3169 2.18806 48.0987C1.34283 48.8955 0.906581 49.8952 0.879316 51.098V57.6378H0Z" fill="white" />
                            <path d="M24.2058 52.4736H18.5414C18.6504 53.4809 19.0321 54.3829 19.6865 55.1797C20.4636 56.1419 21.3633 56.638 22.3858 56.6681H28.4797V57.6378H22.4063C21.1111 57.6077 19.9864 56.9988 19.0321 55.8112C18.1051 54.6986 17.6416 53.4282 17.6416 52C17.6416 50.5718 18.0915 49.2939 18.9912 48.1663C19.9455 46.9937 21.0771 46.3923 22.3858 46.3622H28.4388V47.3319H22.3654C21.3156 47.362 20.4159 47.8581 19.6661 48.8203C19.0253 49.6021 18.6504 50.4966 18.5414 51.5039H24.2058V52.4736Z" fill="white" />
                            <path d="M45.812 46.3622V52.9697C45.7711 54.4431 45.2326 55.6608 44.1965 56.623C43.2149 57.5701 42.0766 58.0287 40.7815 57.9986C39.4864 57.9986 38.3207 57.5476 37.2846 56.6455C36.1395 55.6383 35.5669 54.413 35.5669 52.9697V46.3622H36.4462V52.9472C36.4462 54.1048 36.9097 55.082 37.8368 55.8788C38.7093 56.6455 39.6908 57.0289 40.7815 57.0289C41.8448 57.059 42.7923 56.6831 43.6239 55.9014C44.4691 55.1046 44.9054 54.1048 44.9327 52.9021V46.3622H45.812Z" fill="white" />
                            <path d="M59.7313 51.5039C60.413 51.5039 60.9446 51.2709 61.3264 50.8048C61.6672 50.3688 61.824 49.9178 61.7967 49.4517C61.7967 48.9706 61.6331 48.5271 61.3059 48.1212C60.8697 47.595 60.2426 47.3319 59.4246 47.3319H53.7602V51.5039H59.7313ZM59.445 46.3622C60.522 46.3773 61.3536 46.7456 61.9398 47.4672C62.4306 48.0536 62.676 48.7151 62.676 49.4517C62.7033 50.1734 62.4715 50.8349 61.9807 51.4362C61.7762 51.6918 61.5445 51.8948 61.2855 52.0451C61.4763 52.1654 61.6876 52.3533 61.9194 52.6089C62.3829 53.1952 62.6283 53.8567 62.6556 54.5934V55.8112C62.6556 55.9314 62.6556 56.1269 62.6556 56.3975C62.6692 56.6681 62.676 56.8786 62.676 57.0289V57.6378H61.7967V57.0289C61.7967 56.8786 61.7899 56.6681 61.7762 56.3975C61.7762 56.1269 61.7762 55.9314 61.7762 55.8112V54.6159C61.749 54.1048 61.5786 53.6538 61.265 53.2629C60.856 52.7517 60.2289 52.4886 59.3837 52.4736H53.7602V57.6378H52.8808V46.3622H59.445Z" fill="white" />
                            <path d="M69.7549 57.6378V51.0529C69.7958 49.5645 70.348 48.3317 71.4113 47.3545C72.4202 46.4224 73.5721 45.9713 74.8672 46.0014C76.1624 46.0014 77.3143 46.4599 78.3232 47.377C79.4411 48.3542 80 49.572 80 51.0303V57.6378H79.1207V51.0529C79.1207 49.8952 78.6708 48.918 77.771 48.1212C76.9258 47.3545 75.9579 46.9711 74.8672 46.9711C73.8039 46.941 72.8428 47.3169 71.9839 48.0987C71.0978 48.9255 70.6479 49.9253 70.6343 51.098V57.6378H69.7549ZM74.5401 51.6617C74.6355 51.5565 74.7446 51.5039 74.8672 51.5039C74.9899 51.5039 75.0922 51.5565 75.174 51.6617C75.2558 51.7519 75.2967 51.8647 75.2967 52C75.2967 52.1353 75.2558 52.2481 75.174 52.3383C75.0922 52.4285 74.9899 52.4736 74.8672 52.4736C74.7446 52.4736 74.6355 52.4285 74.5401 52.3383C74.4583 52.2481 74.4174 52.1353 74.4174 52C74.4174 51.8647 74.4583 51.7519 74.5401 51.6617Z" fill="white" />
                            <path d="M75.6268 51.986C75.6268 52.4219 75.2788 52.7752 74.8495 52.7752C74.4202 52.7752 74.0723 52.4219 74.0723 51.986C74.0723 51.5502 74.4202 51.1968 74.8495 51.1968C75.2788 51.1968 75.6268 51.5502 75.6268 51.986Z" fill="white" />
                        </g>
                    </svg>
                </button>
            </div>
            <div className="right">
                <button type="button" className="sound" onClick={onSoundClick}>
                    <SoundBars enabled={soundActive} />
                    <span className="sub-text">Sound</span>
                </button>
                <button type="button" className="auth" onClick={onLoginClick}>
                    <svg width="29" height="34" viewBox="0 0 29 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 25.8889C4 26.5139 3.68251 27.0636 3.20244 27.3806C2.92835 27.5615 2.60126 27.6667 2.25 27.6667C1.2835 27.6667 0.5 26.8707 0.5 25.8889C0.5 24.907 1.2835 24.1111 2.25 24.1111C3.2165 24.1111 4 24.907 4 25.8889Z" />
                        <path d="M28.5 25.8889C28.5 26.8707 27.7165 27.6667 26.75 27.6667C26.3987 27.6667 26.0716 27.5615 25.7976 27.3806C25.3175 27.0636 25 26.5139 25 25.8889C25 24.907 25.7835 24.1111 26.75 24.1111C27.7165 24.1111 28.5 24.907 28.5 25.8889Z" />
                        <path d="M9.25 32.0191C11.0847 31.4621 12.9194 29.9918 13.8578 29.1569C14.2214 28.8335 14.7757 28.8384 15.1205 29.1823C16.4962 30.5542 17.4532 31.3219 19.75 32.0191L26.75 15.2222C26.75 13.3545 26.4331 11.5051 25.8175 9.77961C25.2098 8.0762 24.3227 6.52645 23.2057 5.21648C21.3097 5.97431 17.8543 4.64652 16.5188 4.08848C15.1728 3.52606 13.8266 3.52606 12.4805 4.08848C11.1448 4.64652 7.6902 5.97428 5.79434 5.21647C4.67735 6.52644 3.79021 8.0762 3.18248 9.77961C2.56686 11.5051 2.25 13.3545 2.25 15.2222L9.25 32.0191Z" />
                        <path d="M5.79434 5.21647C7.6902 5.97428 11.1448 4.64652 12.4805 4.08848C13.8266 3.52606 15.1728 3.52606 16.5188 4.08848C17.8543 4.64652 21.3097 5.97431 23.2057 5.21648L23.1621 5.16559C22.0245 3.84494 20.6741 2.79734 19.1879 2.0826C17.7016 1.36787 16.1087 1 14.5 1C12.8913 1 11.2984 1.36787 9.81213 2.0826C8.32589 2.79734 6.97546 3.84494 5.83794 5.16559L5.79434 5.21647Z" />
                        <path d="M26.75 15.2222L19.75 32.0191C22.0846 31.1079 24.2015 29.5617 25.7976 27.3806C25.3175 27.0636 25 26.5139 25 25.8889C25 24.907 25.7835 24.1111 26.75 24.1111V15.2222Z" />
                        <path d="M9.25 32.0191L2.25 15.2222V24.1111C3.2165 24.1111 4 24.907 4 25.8889C4 26.5139 3.68251 27.0636 3.20244 27.3806C4.7985 29.5617 6.91544 31.1079 9.25 32.0191Z" />
                        <path d="M9.25 32.0191C10.9253 32.673 12.7126 33 14.5 33C16.2874 33 18.0747 32.673 19.75 32.0191C17.4532 31.3219 16.4962 30.5542 15.1205 29.1823C14.7757 28.8384 14.2214 28.8335 13.8578 29.1569C12.9194 29.9918 11.0847 31.4621 9.25 32.0191Z" />
                        <path d="M19.75 32.0191L19.9318 32.4849L19.75 32.0191ZM13.8578 29.1569L14.1902 29.5305L13.8578 29.1569ZM15.1205 29.1823L15.4736 28.8282H15.4736L15.1205 29.1823ZM12.4805 4.08848L12.6732 4.54983L12.6732 4.54983L12.4805 4.08848ZM16.5188 4.08848L16.326 4.54983L16.5188 4.08848ZM25.8175 9.77961L26.2885 9.6116V9.6116L25.8175 9.77961ZM23.1621 5.16559L23.5409 4.83929L23.5409 4.83928L23.1621 5.16559ZM19.1879 2.0826L18.9712 2.53321L19.1879 2.0826ZM9.81213 2.0826L10.0288 2.53321L9.81213 2.0826ZM3.18248 9.77961L2.71155 9.6116L3.18248 9.77961ZM3.20244 27.3806L2.92693 26.9633L3.20244 27.3806ZM9.06819 32.4849C10.8029 33.162 12.652 33.5 14.5 33.5V32.5C12.7733 32.5 11.0477 32.1841 9.43181 31.5533L9.06819 32.4849ZM14.5 33.5C16.348 33.5 18.1971 33.162 19.9318 32.4849L19.5682 31.5533C17.9523 32.1841 16.2267 32.5 14.5 32.5V33.5ZM9.39524 32.4976C11.3423 31.9065 13.2467 30.3698 14.1902 29.5305L13.5255 28.7833C12.5921 29.6137 10.8271 31.0178 9.10476 31.5407L9.39524 32.4976ZM14.7674 29.5363C15.4613 30.2283 16.0747 30.7937 16.8188 31.2738C17.5659 31.7559 18.4247 32.1393 19.6048 32.4976L19.8952 31.5407C18.7785 31.2017 18.0104 30.8526 17.3609 30.4335C16.7084 30.0125 16.1554 29.5082 15.4736 28.8282L14.7674 29.5363ZM14.1902 29.5305C14.3642 29.3756 14.6175 29.3868 14.7674 29.5363L15.4736 28.8282C14.9338 28.2899 14.0786 28.2913 13.5255 28.7833L14.1902 29.5305ZM5.55537 5.6588C5.57309 5.66629 5.59089 5.6736 5.60876 5.68075L5.97993 4.75218C5.96805 4.74743 5.95628 4.7426 5.94463 4.73767L5.55537 5.6588ZM5.60876 5.68075C6.71413 6.12259 8.18868 5.94099 9.46516 5.63187C10.771 5.31564 11.9971 4.83233 12.6732 4.54983L12.2877 3.62713C11.6282 3.90268 10.4591 4.36227 9.2298 4.65997C7.97109 4.96478 6.77041 5.06815 5.97993 4.75218L5.60876 5.68075ZM12.6732 4.54983C13.8961 4.03894 15.1034 4.03895 16.326 4.54983L16.7116 3.62714C15.2422 3.01317 13.7572 3.01318 12.2877 3.62713L12.6732 4.54983ZM16.326 4.54983C17.0021 4.83234 18.2283 5.31565 19.5344 5.63189C20.8111 5.94101 22.2858 6.12261 23.3912 5.68076L23.0201 4.75219C22.2296 5.06818 21.0286 4.9648 19.7697 4.65998C18.5402 4.36227 17.371 3.90267 16.7116 3.62714L16.326 4.54983ZM23.3912 5.68077C23.4091 5.67363 23.4269 5.66631 23.4446 5.65882L23.0554 4.73769C23.0437 4.74261 23.032 4.74744 23.0201 4.75219L23.3912 5.68077ZM27.25 15.2222C27.25 13.2984 26.9237 11.3921 26.2885 9.6116L25.3466 9.94763C25.9426 11.6182 26.25 13.4107 26.25 15.2222H27.25ZM26.2885 9.6116C25.6613 7.8539 24.7445 6.25054 23.5861 4.89206L22.8252 5.54089C23.9008 6.80237 24.7582 8.29851 25.3466 9.94763L26.2885 9.6116ZM23.5861 4.89206C23.5711 4.87445 23.556 4.85685 23.5409 4.83929L22.7832 5.49189C22.7972 5.50817 22.8112 5.52451 22.8252 5.54089L23.5861 4.89206ZM23.5409 4.83928C22.3611 3.4695 20.9563 2.37824 19.4046 1.632L18.9712 2.53321C20.3919 3.21643 21.688 4.22037 22.7832 5.4919L23.5409 4.83928ZM19.4046 1.632C17.8525 0.885596 16.1856 0.5 14.5 0.5V1.5C16.0317 1.5 17.5508 1.85014 18.9712 2.53321L19.4046 1.632ZM14.5 0.5C12.8144 0.5 11.1475 0.885596 9.59543 1.632L10.0288 2.53321C11.4492 1.85014 12.9683 1.5 14.5 1.5V0.5ZM9.59543 1.632C8.04367 2.37824 6.63893 3.4695 5.4591 4.83928L6.21678 5.4919C7.31199 4.22038 8.60811 3.21643 10.0288 2.53321L9.59543 1.632ZM5.4591 4.83928C5.44397 4.85684 5.4289 4.87443 5.41388 4.89205L6.17481 5.54088C6.18878 5.5245 6.20277 5.50818 6.21678 5.4919L5.4591 4.83928ZM5.41388 4.89205C4.25553 6.25052 3.33865 7.85389 2.71155 9.6116L3.6534 9.94763C4.24177 8.2985 5.09917 6.80236 6.17481 5.54088L5.41388 4.89205ZM2.71155 9.6116C2.07631 11.3921 1.75 13.2984 1.75 15.2222H2.75C2.75 13.4107 3.0574 11.6182 3.6534 9.94763L2.71155 9.6116ZM20.2115 32.2115L27.2115 15.4146L26.2885 15.0299L19.2885 31.8268L20.2115 32.2115ZM9.71153 31.8268L2.71153 15.0299L1.78847 15.4146L8.78847 32.2115L9.71153 31.8268ZM2.25 27.1667C1.56704 27.1667 1 26.602 1 25.8889H0C0 27.1394 0.999965 28.1667 2.25 28.1667V27.1667ZM1 25.8889C1 25.1757 1.56704 24.6111 2.25 24.6111V23.6111C0.999965 23.6111 0 24.6384 0 25.8889H1ZM2.25 24.6111C2.93296 24.6111 3.5 25.1757 3.5 25.8889H4.5C4.5 24.6384 3.50004 23.6111 2.25 23.6111V24.6111ZM28 25.8889C28 26.602 27.433 27.1667 26.75 27.1667V28.1667C28 28.1667 29 27.1394 29 25.8889H28ZM25.5 25.8889C25.5 25.1757 26.067 24.6111 26.75 24.6111V23.6111C25.5 23.6111 24.5 24.6384 24.5 25.8889H25.5ZM26.75 24.6111C27.433 24.6111 28 25.1757 28 25.8889H29C29 24.6384 28 23.6111 26.75 23.6111V24.6111ZM26.75 27.1667C26.5001 27.1667 26.2683 27.0922 26.0731 26.9633L25.5221 27.7978C25.875 28.0308 26.2974 28.1667 26.75 28.1667V27.1667ZM26.0731 26.9633C25.7291 26.7362 25.5 26.3412 25.5 25.8889H24.5C24.5 26.6866 24.9058 27.3909 25.5221 27.7978L26.0731 26.9633ZM19.9318 32.4849C22.3502 31.5409 24.5459 29.9378 26.2011 27.6758L25.3941 27.0853C23.8571 29.1856 21.8189 30.6748 19.5682 31.5533L19.9318 32.4849ZM26.25 15.2222V24.1111H27.25V15.2222H26.25ZM3.5 25.8889C3.5 26.3412 3.27087 26.7362 2.92693 26.9633L3.47794 27.7978C4.09416 27.3909 4.5 26.6866 4.5 25.8889H3.5ZM2.92693 26.9633C2.73169 27.0922 2.49988 27.1667 2.25 27.1667V28.1667C2.70264 28.1667 3.12501 28.0308 3.47794 27.7978L2.92693 26.9633ZM2.79893 27.6758C4.45413 29.9378 6.64981 31.5409 9.06819 32.4849L9.43181 31.5533C7.18107 30.6748 5.14287 29.1856 3.60594 27.0853L2.79893 27.6758ZM1.75 15.2222V24.1111H2.75V15.2222H1.75ZM23.5853 4.89113L23.5417 4.84024L22.7824 5.49094L22.826 5.54183L23.5853 4.89113ZM5.45828 4.84024L5.41468 4.89111L6.17401 5.54182L6.2176 5.49095L5.45828 4.84024Z" fill="white" />
                    </svg>
                    <span className="sub-text">Start</span>
                </button>
            </div>

            <LoginMenu active={loginActive} onClickOutside={onLoginClickOutside} />
        </header>
    );
}
